# weeder

Пет проект

**Идея:**

Распознавание и удаление сорняков.
Предпосылки:
Сейчас очень популярно направление органического земледелия,
в рамках этого направления стараются уйти от использование химических средств для борьбы с сорняками, в то же время ручной труд обходится дорого.

За основу взято существующее решение https://www.youtube.com/watch?v=AP0yiOI8Qas удаление сорняков передвижной платформой с лазером.
![](readme_media/weeder_preview.gif)
Цель этого проекта сделать программный функционал, по распознаванию и управлению подобным аппаратом верхнеуровнево, без аппаратной сборки.

## Реализация проекта:
## 1. Датасет
Необходимо различать сорняки от полезной культуры, т.е. задача сегментации. 
А также детекция основания растения(чтобы удалять сорняк под корень).
По пересечению двух данных результатов будут отбираться нужные boundary boxы.

Подобный датасет не имеется в свободном доступе, размечать в ручную долго и дорого.
Решение: синтетический датасет путем генерации изображений в blender.

### 1. Задаем модели
В качестве сорняка был выбран одуванчик, в качестве полезной культуры клубника.
Генерировалась поверхность земли. 
![](readme_media/weeder_1_Models.gif)
### 2. Рандомизация объектов и окружения
Кастомизировалось растение(изменение количества листьев, наклона, поворота, масштаба, формы, цвета), растения расставлялись по поверхности, менялось освещение и положение камеры. 
![](readme_media/weeder_2_Randomization.gif)
### 3. Создание изображений для задачи сегментации и детекции
Делался рендеринг изображения, затем менялись цвета для создания карты сегментаций, изображение сохранялось и в конце еще делалось третье изображение, выделяли boundary boxы(у каждого растения у основания располагался невидимый цилиндр, при третьей генерации его делали видимым, а дальше просчитывались уже координаты вершин.) Boundary box просчитывались дважды. Первый програмно в blender через проекцию на плоскость камеры, получая точные координаты, второй через рендеринг сцены, так как часть объектов может заслоняться другими растениями.
Запустив цикл, получили 3500 изображения 512 на 512px.
![](readme_media/weeder_3_Dataset.gif)
### 4. Обучение моделей
Сначала предобработали картинки с сегментацией и boundary box, убрав переходные цвета.
Обработали изображения Boundary box, получили координаты. Так как некоторые боксы могут быть разделены пополам из-за перекрываний, обработчик определяет их как два отдельных бокса, чтобы исправить это мы использовали координаты из csv файла для сопоставления и объединения.
Модель для сегментации и детекции выбрали небольшие, для использования на android в дальнейшем, для сегментации U-Net, для детекции Yolos.
![](readme_media/weeder_4_Model_training.gif)

## 2. Приложение.
Функционал реализован как мобильное приложение для android. Сегментация, детекция и просчет будет осуществляться самим смартфоном, по bluetooth каналу будет передавать координаты углов для поворотного механизма для нацеливания на сорняк.
Сам смартфон будет крепиться в передней части устройства, на поворотном механизме с лазером.
